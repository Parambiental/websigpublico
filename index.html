<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Visor SIG Avanzado - Leaflet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Plugins CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-measure/dist/leaflet-measure.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-easybutton/src/easy-button.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-sidebar-v2/css/leaflet-sidebar.min.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <!-- Sidebar ejemplo -->
  <div id="sidebar" class="leaflet-sidebar collapsed">
    <div class="leaflet-sidebar-tabs">
      <ul role="tablist">
        <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
        <li><a href="#info" role="tab"><i class="fa fa-info"></i></a></li>
      </ul>
    </div>
    <div class="leaflet-sidebar-content">
      <div class="leaflet-sidebar-pane" id="home">
        <h1 class="leaflet-sidebar-header">Herramientas SIG</h1>
        <p>Explora las herramientas disponibles en este visor.</p>
      </div>
      <div class="leaflet-sidebar-pane" id="info">
        <h1 class="leaflet-sidebar-header">Información</h1>
        <p>Este visor utiliza Leaflet y más de 50 herramientas SIG.</p>
      </div>
    </div>
  </div>
  <!-- Librerías JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  <script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js"></script>
  <script src="https://unpkg.com/leaflet-measure/dist/leaflet-measure.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script src="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.js"></script>
  <script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet-easybutton/src/easy-button.js"></script>
  <script src="https://unpkg.com/leaflet-sidebar-v2/js/leaflet-sidebar.min.js"></script>
  <!-- FontAwesome para iconos del sidebar -->
  <script src="https://kit.fontawesome.com/1d2a7f6e5c.js" crossorigin="anonymous"></script>
  <script>
    // Inicialización del mapa
    const map = L.map('map', {
      fullscreenControl: true
    }).setView([-25.2637, -57.5759], 13);

    // Capas base
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    const stamenToner = L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/toner/{z}/{x}/{y}.png', {
      maxZoom: 20,
      attribution: 'Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap'
    });

    // Capa WMS de ejemplo
    const catastroWMS = L.tileLayer.wms('https://ahocevar.com/geoserver/wms', {
      layers: 'topp:states',
      format: 'image/png',
      transparent: true,
      attribution: 'Ejemplo WMS'
    });

    // Control de capas
    const baseLayers = {
      "OpenStreetMap": osm,
      "Stamen Toner": stamenToner,
    };
    const overlays = {
      "Catastro WMS": catastroWMS,
    };
    L.control.layers(baseLayers, overlays, { collapsed: false }).addTo(map);

    // Minimapa
    const miniMap = new L.Control.MiniMap(osm, { toggleDisplay: true }).addTo(map);

    // Control de escala
    L.control.scale().addTo(map);

    // Geolocalización
    L.control.locate({ position: "topleft", strings: { title: "Mostrar mi ubicación" } }).addTo(map);

    // Medición de distancias y áreas
    L.control.measure({ position: 'topleft' }).addTo(map);

    // Geocodificador (buscador de direcciones)
    L.Control.geocoder().addTo(map);

    // Dibujo y edición
    const drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);
    const drawControl = new L.Control.Draw({
      edit: { featureGroup: drawnItems },
      draw: {
        polygon: true,
        polyline: true,
        rectangle: true,
        circle: true,
        marker: true,
      },
    });
    map.addControl(drawControl);
    map.on(L.Draw.Event.CREATED, function (e) {
      drawnItems.addLayer(e.layer);
    });

    // Agrupación de marcadores (ejemplo)
    const markers = L.markerClusterGroup();
    for (let i = 0; i < 100; i++) {
      const marker = L.marker([
        -25.2637 + (Math.random() - 0.5) * 0.1,
        -57.5759 + (Math.random() - 0.5) * 0.1
      ]).bindPopup('Marcador ' + (i + 1));
      markers.addLayer(marker);
    }
    map.addLayer(markers);

    // Botón personalizado (ejemplo)
    L.easyButton('fa-home', function(btn, map){
      map.setView([-25.2637, -57.5759], 13);
    }, 'Volver al inicio').addTo(map);

    // Sidebar
    const sidebar = L.control.sidebar({
      autopan: true,
      closeButton: true,
      container: 'sidebar',
      position: 'right'
    }).addTo(map);

    // Pantalla completa (ya integrado en la inicialización)

    // Agrega aquí más plugins y herramientas según la lista sugerida.
    // Ejemplo: Leaflet.heat, leaflet-timedimension, leaflet-routing-machine, etc.
    // Consulta https://leafletjs.com/plugins.html para más opciones.

    // Ejemplo: Mostrar coordenadas al hacer clic
    map.on('click', function(e) {
      L.popup()
        .setLatLng(e.latlng)
        .setContent('Coordenadas: ' + e.latlng.lat.toFixed(5) + ', ' + e.latlng.lng.toFixed(5))
        .openOn(map);
    });
  </script>
</body>
</html>
